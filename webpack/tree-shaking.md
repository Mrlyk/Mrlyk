# tree-shaking

webpack 的 tree-shaking 和我以为的不太一样，我以为是直接剔除没有用到的模块，然而没有用到的模块本就不会被打包。实际上 tree-shaking 是剔除模块中没有用到的变量、方法等，更高级一点。

~~区分 DCE 和 tree shaking。~~

tree-shaking 因 rollup.js 这个打包工具而普及。

想要实现 tree-shaking 必须满足一个条件——**模块必须是 ESM**。因为tree-shaking依赖于 ESM 的静态特性（依赖关系在编译前就会确定）。

## 为什么需要声明 sideEffects

ES6 模块系统的`import`和`export`是静态的，这意味着依赖关系在编译时就已确定，并且不能在运行时动态更改。这个特性使得工具可以在编译时进行摇树优化（Tree Shaking），移除未被使用的代码。

然而，即使是静态的ES6模块，**代码中仍然可能存在副作用**。副作用（side effects）是指那些在模块被执行时对状态产生影响的代码，而**这些影响并不是通过模块的导出来体现的**。例如，一个模块可能会修改全局变量、对DOM进行操作、或者在被导入时立即执行某些逻辑（如即刻执行的函数）。

所以纵使依赖关系是明确的，纵使我们只引入了模块中的一个方法，只要我们没有声明这个模块无副作用，那么模块中的其他内容还是会被打包进来。这可能会引起一些问题，比如模块中我们未引入的方法有一些不兼容的语法，在编译时可能会导致报错。





## 参考文章

- 《vuejs 设计与实现》
- Tree shaking问题排查指南: https://mp.weixin.qq.com/s/SfZbBg0lWhvgzS023wTjYA 