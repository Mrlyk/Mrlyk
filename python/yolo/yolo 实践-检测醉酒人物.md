# yolo å®žè·µ-æ£€æµ‹é†‰é…’äººç‰©

é¦–å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„æ£€æµ‹ðŸŒ°ï¼š

å…¶ä¸­æ¨¡åž‹ä½¿ç”¨çš„æ˜¯ yolo å®˜æ–¹é¢„è®­ç»ƒå¥½çš„ï¼Œå¯ä»¥æ£€æµ‹ç”»é¢ä¸­äººã€é¢†å¸¦ã€ä¹Ÿå¯ä»¥æ£€æµ‹æ±½è½¦ã€å¡è½¦ï¼

```python
import torch  # ç”¨æ¥åŠ è½½ yolo æ¨¡åž‹å’Œåšæ£€æµ‹c
import matplotlib
from matplotlib import pyplot as plt  # å›¾å½¢ç»˜åˆ¶åº“ ç”¨äºŽå›¾ç‰‡å¯è§†åŒ–ç»˜åˆ¶
import numpy as np  # ç”¨äºŽæ•°ç»„è½¬æ¢
import cv2  # ç”¨æ¥è®¿é—®æ‘„åƒå¤´å’Œå›¾ç‰‡ï¼Œå¯ä»¥åœ¨è§†é¢‘æµä¸Šå®žæ—¶ç»˜åˆ¶



# åŠ è½½æ¨¡åž‹ æŽ¥æ”¶ä¸€ä¸ªä»“åº“æœ‰åœ°å€å’Œè¦åŠ è½½çš„æ¨¡åž‹ï¼Œä»Žè¿œç¨‹ä»“åº“åŠ è½½æ¨¡åž‹ï¼ˆä¸‹è½½è·¯å¾„ï¼šC:/Users/.cache\torch\hub\master.zipï¼‰
# è¿™ä¸ªæ¨¡åž‹æ˜¯å·²ç»é¢„è®­ç»ƒè¿‡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨ yolov5 çš„æ—¶å€™å®žé™…åªè¦èŽ·å¾—å…¶è®­ç»ƒåŽçš„æ¨¡åž‹å°±å¯ä»¥äº†
model = torch.hub.load('ultralytics/yolov5', 'yolov5s')

# print('æŸ¥çœ‹å½“å‰æ¸²æŸ“ä½¿ç”¨çš„æ˜¯å“ªä¸ª gui å¼•æ“Ž', matplotlib.get_backend())
# é»˜è®¤æ˜¯ TkAgg ä½¿ç”¨ Tkinterï¼ˆå³ tk interfaceï¼‰ æ˜¯ Python æ ‡å‡† GUI åº“ï¼Œç®€ç§° â€œTkâ€ï¼Œä¸Šé¢åŠ è½½æ¨¡åž‹ä¼šæŠŠè¿™é‡Œé‡ç½®ä¸º aggï¼ˆä¸è‡ªå¸¦ guiï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œé‡æ–°å£°æ˜Žäº†ä¸€é
matplotlib.use('TkAgg')


# æ£€æµ‹å›¾ç‰‡
# img = 'https://ultralytics.com/images/zidane.jpg' # å¯ä»¥è¿œç¨‹åŠ è½½
img = './drowsiness-detection/data/images/zidane.jpg' # ä¸ºäº†é€Ÿåº¦è¿˜æ˜¯ç”¨æœ¬åœ°çš„

# ç»™æ¨¡åž‹ä¼ å…¥æˆ‘ä»¬è¦æ£€æµ‹å›¾ç‰‡ï¼Œåªè¦å­—ç¬¦ä¸²è·¯å¾„å³å¯
results = model(img)  

# è¾“å‡ºæ£€æµ‹ç»“æžœï¼ˆè¿™é‡Œç”¨ yolov5s æ£€æµ‹å‡º 2 ä¸ªäººï¼Œç”¨ yolov5m ç¡®å®šæ£€æµ‹å‡º 3 ä¸ªï¼ŒæŽ¨æµ‹æ˜¯åŽè€…è¯†åˆ«æ›´å¼ºï¼Œè¯†åˆ«äº†èƒŒæ™¯ä¸­çš„äººï¼Ÿè¿™ç‚¹å€¼å¾—æ³¨æ„ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åªéœ€è¦ä¸»ç”»é¢çš„ï¼‰
results.print()
print(results.xyxy) # å¯ä»¥è¾“å‡ºæ¨¡åž‹æ£€æµ‹åˆ°çš„å¼ é‡åæ ‡


plt.imshow(np.squeeze(results.render())) # ç»˜åˆ¶æ£€æµ‹ç»“æžœ

plt.show()
```

## å®žæ—¶æ£€æµ‹

ä¸Šé¢çš„ðŸŒ°æ£€æµ‹æ˜¯ç¦æ­¢çš„ç”»é¢ï¼Œä¸‹é¢é€šè¿‡ opencv æ¥èŽ·å–æ‘„åƒå¤´ç”»é¢è¿›è¡Œå®žæ—¶æ£€æµ‹ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ opencv æ•èŽ·å±å¹•å¯¹å±å¹•ä¸Šçš„ç”»é¢è¿›è¡Œå®žæ—¶æ£€æµ‹ï¼





## è‡ªå®šä¹‰æ£€æµ‹ç›®æ ‡



- `cv2.waitKey(1000)`ï¼šåœ¨1000mså†…æ ¹æ®é”®ç›˜è¾“å…¥è¿”å›žä¸€ä¸ªå€¼ã€‚waitKey() å‡½æ•°çš„åŠŸèƒ½æ˜¯ä¸æ–­åˆ·æ–°å›¾åƒ , é¢‘çŽ‡æ—¶é—´ä¸ºdelay , å•ä½ä¸ºms ã€‚è¿”å›žå€¼ä¸ºå½“å‰é”®ç›˜æŒ‰é”®å€¼
- `0xFF` ï¼šä¸€ä¸ªåå…­è¿›åˆ¶æ•°
- `ord('q')` ï¼šè¿”å›žqçš„asciiç 

0xFFæ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œè½¬æ¢ä¸ºäºŒè¿›åˆ¶æ˜¯11111111ã€‚waitKeyè¿”å›žå€¼çš„èŒƒå›´ä¸ºï¼ˆ0-255ï¼‰ï¼Œåˆšå¥½ä¹Ÿæ˜¯8ä¸ªäºŒè¿›åˆ¶ä½ã€‚é‚£ä¹ˆæˆ‘ä»¬å°† cv2.waitKey(1) & 0xFFè®¡ç®—ä¸€ä¸‹ï¼Œå‘çŽ°ç»“æžœä»ç„¶æ˜¯ waitKey çš„è¿”å›žå€¼ï¼Œé‚£ä¸ºä½•è¦å¤šæ¬¡ä¸€ä¸¾å‘¢ï¼Ÿç›´æŽ¥ cv2.waitKey(1) == ord('q')ä¸å°±å¥½äº†å—ã€‚

**å®žé™…ä¸Šåœ¨linuxä¸Šä½¿ç”¨waitkeyæœ‰æ—¶ä¼šå‡ºçŽ°waitkeyè¿”å›žå€¼è¶…è¿‡äº†ï¼ˆ0-255ï¼‰çš„èŒƒå›´çš„çŽ°è±¡**ã€‚é€šè¿‡cv2.waitKey(1) & 0xFFè¿ç®—ï¼Œå½“waitkeyè¿”å›žå€¼æ­£å¸¸æ—¶ cv2.waitKey(1) = cv2.waitKey(1000) & 0xFF,å½“è¿”å›žå€¼ä¸æ­£å¸¸æ—¶ï¼Œcv2.waitKey(1000) & 0xFFçš„èŒƒå›´ä»ä¸è¶…è¿‡ï¼ˆ0-255ï¼‰ï¼Œå°±é¿å…äº†ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„BUGã€‚

## æ¨¡åž‹æ£€æµ‹åˆ°çš„å¼ é‡

ä¸Šé¢æˆ‘ä»¬è¾“å‡ºäº†å¼ é‡`print(results.xyxy) `ï¼Œç»“æžœå¦‚ä¸‹å›¾

```text
[tensor([[7.43291e+02, 4.83438e+01, 1.14176e+03, 7.20000e+02, 8.79861e-01, 0.00000e+00],
        [4.41990e+02, 4.37337e+02, 4.96585e+02, 7.10036e+02, 6.75119e-01, 2.70000e+01],
        [1.23051e+02, 1.93238e+02, 7.14690e+02, 7.19771e+02, 6.66693e-01, 0.00000e+00],
        [9.78990e+02, 3.13579e+02, 1.02530e+03, 4.15526e+02, 2.61517e-01, 2.70000e+01]], device='cuda:0')]
```

å…¶ä¸­ä¸€ä¸ªåˆ—è¡¨çš„ç»“æžœä»Žå‰å¾€åŽä¾æ¬¡æŒ‡ (e+02 -> * 10^2)

- xmin
- ymin
- xmax
- ymax
- confidence
- class