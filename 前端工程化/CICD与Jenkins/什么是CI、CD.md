# CI/CD

> 持续集成 (Continuous Integration) ，CD 持续交付（Continuous Delivery）、持续部署 (Continuous Deployment)

## 定义

现代软件开发往往是在基础功能上持续迭代，迭代过程中如果每次都由运维人员去手动发布测试，测试完成再手动部署到正式服务器非常繁琐且浪费时间。因此 CI/CD 的方案出现了。

**CI/CD 是一种解决方案，能够“自动的”频繁集成、交付和部署。**

具体而言，CI/CD 可以从集成和测试阶段，到交付和部署实现完全的持续自动化。CI/CD 是实施 DevOps 的一大重要成果，可以帮助开发者频繁的向客户交付应用，而且只需要极少的人工干预。

```tex
DevOps: Dev（development，开发）Ops（Operations，运维）。DevOps 是一组过程、方法与系统的统称，用于促进开发、运营和质量保障部门之间的沟通、协作和整合。通俗的说就是促进和便利从开发到部署到快速落地迭代，在 DevOps 的流程下，运维人员会在项目开发期间就介入到开发过程中，了解开发人员使用的系统架构和技术路线，从而制定适当的运维方案。而开发人员也会在运维的初期参与到系统部署中，并提供系统部署的优化建议。
```

## 一、CI

> 持续集成

现代应用开发的目标是让多位开发人员同时处理同一应用的不同功能。但是，如果企业安排在一天内将所有分支源代码合并在一起（称为“合并日”），最终可能造成工作繁琐、耗时，而且需要手动完成。这是因为当一位独立工作的开发人员对应用进行更改时，有可能会与其他开发人员同时进行的更改发生冲突。如果每个开发人员都自定义自己的本地集成开发环境，而不是让团队就一个基于云的 IDE 达成一致，那么就会让问题更加雪上加霜。

持续集成（CI）可以帮助开发人员更加频繁地（有时甚至每天）将代码更改合并到共享分支或“主干”中。一旦开发人员对应用所做的更改被合并，系统就会通过自动构建应用并运行不同级别的自动化测试（通常是单元测试和集成测试）来验证这些更改，确保这些更改没有对应用造成破坏。这意味着测试内容涵盖了从类和函数到构成整个应用的不同模块。如果自动化测试发现新代码和现有代码之间存在冲突，CI 可以更加轻松地快速修复这些错误。

**通俗的说，多次提交减少冲突，多次单元测试，而不是等到项目截止日期再大家一起提交。**

## 二、CD

> 持续交付、持续部署

###  持续交付

持续交付是将在 CI 中构建、测试完成后的代码，提交到一个可随时部署到生产环境的代码库（分支）。

###  持续部署

对于一个成熟的 CI/CD 管道来说，最后的阶段是持续部署。作为持续交付——自动将生产就绪型构建版本发布到代码存储库——的延伸，持续部署可以自动将应用发布到生产环境。由于在生产之前的管道阶段没有手动门控，因此持续部署在很大程度上都得依赖精心设计的测试自动化。

实际上，持续部署意味着开发人员对应用的更改在编写后的几分钟内就能生效（假设它通过了自动化测试）。这更加便于持续接收和整合用户反馈。总而言之，所有这些 CI/CD 的关联步骤都有助于降低应用的部署风险，因此更便于以小件的方式（而非一次性）发布对应用的更改。不过，由于还需要编写自动化测试以适应 CI/CD 管道中的各种测试和发布阶段，因此前期投资还是会很大。

**通俗的说就是将交付后到代码自动发布到生产环境**

## 三、CI/CD 管道

> CI/CD 管道是为了交付新版本的软件而必须执行的一系列步骤，是一套专注于使用 DevOps 或 SRE（站点可靠性工程）方法来改进软件交付的实践。

CI/CD 在整个应用生命周期内（从集成和测试阶段，到交付和部署）都引入了持续自动化和持续监控，而不用手动执行。

### CI/CD 管道的要素

构成 CI/CD 管道的步骤被划分为不同的任务子集，称之为管道阶段。典型的管道阶段包括：

- 构建 - 进行应用编译的阶段
- 测试 - 代码测试阶段
- 发布 - 将应用交付到存储库的阶段
- 部署 - 将代码部署到生产环境中的阶段