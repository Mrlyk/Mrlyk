# 函数式编程

> 函数式编程是指为创建不变的程序，通过消除外部可见的副作用，来对纯函数的生命式的求职过程。

为什么要使用函数式？

js 的设计灵感来源于 Lsip、Schema 这样的函数式语言，所以 js 对函数式有天然的亲和性！

函数式编程的核心目标就是消除外部可见副作用。比如在 js 中使用全局变量就可能会带来副作用，在函数式编程中我们要尽量避免。

```js
/*=============普通方式==============*/
let count = 0 // 这个全局变量可能会被随时更改，每次调用返回的结果不能确定

function test () {
  return count++
}

/*=============函数式============*/
function test (count) { // 参数相同的情况下，输出永远相同
  return count++
}
```

像上面函数式这种没有副作用和状态变化的函数一般称为——**纯函数**！

## 什么是函数式编程

函数式编程是一种**编程范式**，它将计算视为函数的操作，并**通过组合不同的函数来实现程序的逻辑**。

比如 js 中数组的内置方法 `map`、`filter` 都算是函数式编程的一种实现，他们接收一个函数来对数据进行操作。这种接收一个函数作为参数或者返回一个函数的函数也被称为——高阶函数！

像我们经常听到的柯里化函数也属于高阶函数，也是函数式编程思想的一种实现。

使用函数式编程的思想，我们可以将一个操作拆分成多个简单的函数，并使用这些函数的组合来实现复杂的逻辑，这有助于我们更好地组织代码，使其变得更加简洁、可重用、易于维护。

## 函数式的优点

- 将复杂函数分解为简单函数
- **链式调用处理数据，代码更清晰**（职责链模式）
- 通过响应式范式降低事件驱动代码的复杂性

传统的命令式代码的缺点是限定于高效地解决某个特定的问题，比起函数式代码抽象水平要低的多。抽象层次越低，代码重用的概率就会越低，出现错误的复杂性和可能性就会越大！

## 区分面向对象与函数式

js 既是面向对象的也是函数式的，面向对象编程和函数式编程之间也有差异！

面向对象的核心之一是继承。我们可以通过继承的方式派生出具有更多功能的子类，同时又保留了父类的功能！

|            | 函数式                         | 面向对象                 |
| ---------- | ------------------------------ | ------------------------ |
| 基本单元   | 函数                           | 对象（类）               |
| 编程风格   | 声明式                         | 命令式                   |
| 数据和行为 | 独立的纯函数                   | 与方法紧耦合的类         |
| 状态管理   | 将对象视为不可变的值           | 主张通过实例方法改变对象 |
| 程序流控制 | 函数与递归                     | 循环与条件               |
| 线程安全？ | 可并发                         | 难以实现                 |
| 封装性     | 因为一切都是可变的，所以没必要 | 需要保护数据的完整性     |

虽然两者有差异，但是编写项目时我们仍然会混合两种方式！

其中要注意的点是在函数式思想下，我们要注意对象的状态。比如`Array.prototype.reverse()` 这种会直接改变原始对象状态的方法是非常不提倡使用的。我们可以使用`...`运算符复制一份对象再进行操作。这样才符合函数式思想——将对象视为不可变的值。

## 在 javascript 中运用函数式编程

在 js 中我们应该如何运用函数式编程的思想呢？我们直接从实际出发来看一下。

#### 链接方法

假设有这样一个字符串`Functional Programming`我们需要将第一个单词转小写并拼接上`is fun`这个字符串。

基于函数式思维的链接方法，我们可以用如下方式来写。

```js
'Functional Programming'.slice(0, 10).toLowerCase() + 'is fun'
```

如果要更加函数式的风格，他可能像下面这样：

```js
concat(toLowerCase(substring('Functional Programming', 0, 10)), 'is fun')
```

函数式的思维需要我们将操作拆分成多个函数，并将它们组合起来

上面的函数的每个参数都明确在函数中定义，而且也没有产生任何副作用，非常符合函数式的风格。但是阅读起来比较累，得一层层看。

无论用哪种方法我们都要保持函数式思维中的对象不可变性！



## 其他

#### weakmap 实现私有变量

私有变量，我们第一时间想到的方法应该是——闭包。

实现私有变量的方式在 es6 中直接提供了 `#` （哈希）关键字。我们也可以使用`weakmap` 或闭包来实现私有变量。

通过 `weakmap` 实现私有变量：

```js
const wm = new WeakMap()

class P {
  constructor() {
    wm.set(this, {_name: 'test'})
  }
  get name() {
    return wm.get(this)._name
  }
}
```

我们会将函数看作一个**基于输入的且尚未求值的不可变的值！**

