# 常用知识点

> 这里对一些其他常用的 node 模块和一些 node 相关知识做记录

[toc]

## readline

官方文档：http://nodejs.cn/api-v14/readline.html#readline

可读流逐行读取模块，**可以用来和我们的命令行交互，从我们的输入流`process.stdin`中读取数据** 。

*脚手架的构建工具 inquire.js 中就使用了他* 

#### 基础使用

```js
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin, // 输入流，命令行输入
  output: process.stdout // 输出流，命令行输出
});

rl.question('What do you think of Node.js? ', (answer) => {
  console.log(`Thank you for your valuable feedback: ${answer}`);
  rl.close();
});
```

## node require hook

Node.js 当 require 一个模块的时候，内部会分别调用 `Module.load、Module._extensions['.js']、Module._compile `这三个方法，然后才是执行。

![image-20220224104949950](https://liaoyk-markdown.oss-cn-hangzhou.aliyuncs.com/markdownImg/image-20220224104949950.png?x-oss-process=image/resize,w_400,m_lfit)  

**`Module.load` 中使用 `Module._extensions`来加载对象**

![image-20220224105450281](https://liaoyk-markdown.oss-cn-hangzhou.aliyuncs.com/markdownImg/image-20220224105450281.png?x-oss-process=image/resize,w_500,m_lfit) 

**而 require 中又使用 `module._compile`来最终编译模块`** 

![image-20220224105635451](https://liaoyk-markdown.oss-cn-hangzhou.aliyuncs.com/markdownImg/image-20220224105635451.png?x-oss-process=image/resize,w_500,m_lfit) 

同理，ts 模块、json 模块等也是一样的流程，那么我们只需要劫持 `Module._extensions[扩展名]`的方法，就能达到 hook 的目的。比如劫持 ts 文件的加载

```js
Module._extensions['.ts'] = function (module, filename) {
	// module._compile = ....
}
```



