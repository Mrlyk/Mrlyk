# js 时间分片

看 vue 性能优化和 react fiber 的时候都看到了这种技术，简单来说就是将一个计算量巨大的连续任务拆解成一个个小任务，让主线程不至于被一直阻塞导致浏览器卡死的优化手段！

当然这种方式的也有缺点就是会增长原本任务的执行时间，比如原来可能 3 秒执行完成，现在要5秒！比起浏览器直接卡死还是好多了，还可以增加 loading 交互来让用户体验更好！

在 js 中实现有三种方式

1. 使用 setimeout 这样的定时器来分批渲染
2. 借助生成器函数，在到达分片时间后让渡执行权
3. 通过回调函数

第一种最简单就不展开说了，简单来说就是通过定时器将一个大的渲染任务或者可以简单拆解的任务分批次执行。

优点就是简单

缺点就1）是任务拆解开了也有大有小，除非明确每个任务的工作内容都差不多，否则依然可能会造成卡死；2）定时器的间隔时间不好确定，不同显示器刷新率不通，而定时器只能明确放进任务队列的时候而不能确定实际执行时间，所以可能会造成闪屏现象。

下面重点说说另外两个方式

这两个方式还会用到一个 api：`window.requestIdleCallback`，**在浏览器将切换到下一个任务之间的空闲时调用，又称空闲调度函数**

## 通过 generator 实现分片（推荐）

前提条件：**被分片的函数需要是通过 generator 函数写的，在耗时的任务处 `yield` 让渡**



## 通过回调函数实现分片

这种实现的方式的好处在于兼容性



## 参考文章

两种 JavaScript 时间分片技术：https://juejin.cn/post/6981711232470515725

Time-Slice 的理解和运用：https://iming.work/detail/5fdab45c08f77e7bee59e670.html