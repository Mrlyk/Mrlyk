# react hooks

æ¥äº†æ¥äº†ï¼Œè¢«äººç‹‚å¹çš„ react hooksï¼Œvue ä»ä¸­å­¦ä¹ çš„ hooksã€‚æ¥ä¸€ç¹ react hooks çš„çœŸå®¹ã€‚

**ä¸ºä»€ä¹ˆè¦æœ‰ react hooksï¼Ÿ**

å‰é¢æˆ‘ä»¬å­¦ä¹ äº†æ™®é€šçš„ç±»ç»„ä»¶ï¼Œèƒ½æ„Ÿå—åˆ°å‡ ä¸ªé—®é¢˜

1. å†™èµ·æ¥éº»çƒ¦
2. ç”Ÿå‘½å‘¨æœŸç”¨èµ·æ¥ä¹Ÿæ²¡é‚£ä¹ˆèˆ’æœï¼Œç»å¸¸è¦æ³¨æ„é‡æ¸²æŸ“çš„é—®é¢˜
3. åŸæœ‰çš„å‡½æ•°å¼ç»„ä»¶çªç„¶æœ‰çŠ¶æ€åŒ–çš„éœ€æ±‚äº†ï¼Œéœ€è¦é‡å†™

æ‰€ä»¥ react hooks è¯ç”Ÿäº†ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­

- ä¿å­˜çŠ¶æ€
- å¤„ç†å‰¯ä½œç”¨ï¼ˆç±»ä¼¼ vue watch ä½†ä¸ä¸€æ ·ï¼‰
- ......

**hooks ä¹Ÿä»…èƒ½åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ä½¿ç”¨ï¼** 

[toc]

## hooks API

#### useState å‡½æ•°å¼ç»„ä»¶ä¸­çš„çŠ¶æ€

å‡½æ•°å¼ç»„ä»¶æœ€å¤§çš„ç—›ç‚¹æ˜¯æ²¡æœ‰çŠ¶æ€ã€‚react é€šè¿‡æä¾›`useState`è¿™ä¸ª hooks æ¥æä¾›äº†çŠ¶æ€ï¼

```react
import React, { useState } from 'react'

export default function UseStateComponent () {
  const [name, setName] = useState('123')

  console.log('é‡æ–°æ‰§è¡Œ')
  return (
    <div>
      UseStateComponent
      <button
        onClick={() => {
          setName('456')
        }}
      >click
      </button>
      <div>{name}</div>
    </div>
  )
}
```

**åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ï¼Œthis æŒ‡å‘ undefinedï¼Œå› ä¸ºå‡½æ•°å¼ç»„ä»¶åªè¢«å½“ä½œæ™®é€šå‡½æ•°è°ƒç”¨ï¼**

åœ¨ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬èƒ½çœ‹åˆ°

- `useState`è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•°ç»„è§£æ„è·å¾—ä¸¤ä¸ªå¯¹è±¡ã€‚
  1. ç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬ä½¿ç”¨`useState`æ—¶ä¼ å…¥çš„åˆå§‹å€¼ï¼Œä¹Ÿæ˜¯å‡½æ•°å¼ç»„ä»¶ä¸­çš„çŠ¶æ€
  2. ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥æ”¹å˜çŠ¶æ€ï¼Œ**è§¦å‘å‡½æ•°å¼ç»„ä»¶çš„é‡æ–°æ‰§è¡Œ**

åŒæ ·**æˆ‘ä»¬ä¹Ÿä¸èƒ½ç›´æ¥å»ç»™ `useState` å®šä¹‰çš„çŠ¶æ€èµ‹å€¼**ï¼ŒåŸå› æ˜¯å’Œ`setState`ä¸€æ ·çš„ï¼ï¼ï¼

**ç»è¯•éªŒå‘ç°ï¼Œä½¿ç”¨ `useState`å¤šæ¬¡æ”¹å˜çŠ¶æ€æ—¶ï¼Œç¬¬ä¸€æ¬¡æ”¹å˜ä¸ºç›¸åŒçš„å€¼æ—¶å‡½æ•°å¼ç»„ä»¶ä¼šé‡æ–°æ‰§è¡Œï¼Œç¬¬äºŒæ¬¡åˆ™ä¸ä¼šã€‚åº”è¯¥æ˜¯ react è‡ªèº«çš„ä¼˜åŒ–**

ä¸¾ä¸ªğŸŒ°ï¼šä¸Šé¢çš„å‡½æ•°å¼ç»„ä»¶ä½¿ç”¨`setName('456')`ï¼Œclick ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡éƒ½ä¼š"é‡æ–°æ‰§è¡Œ"ï¼Œç¬¬ä¸‰æ¬¡å°±ä¸ä¼šäº†ã€‚å¦‚æœæ˜¯`setName('123')`å³ç¬¬ä¸€æ¬¡éƒ½ä¸€æ ·çš„è¯ï¼Œé‚£ä¹ˆä¸€æ¬¡â€œé‡æ–°æ‰§è¡Œâ€éƒ½ä¸ä¼šï¼

**æ€»ç»“ä¸€ä¸‹ setStateï¼š**

1. æ›´æ–°å¼‚æ­¥
2. **æ›´æ–°ä¼šè§¦å‘æ•´ä¸ªå‡½æ•°å¼ç»„ä»¶çš„é‡æ–°æ‰§è¡Œï¼ŒåŒ…æ‹¬åŸæ¥åœ¨è¿™ä¸ªç»„ä»¶é‡Œå£°æ˜çš„å¯¹è±¡ã€å‡½æ•°éƒ½å·²ç»ä¸æ˜¯åŸæ¥çš„é‚£ä¸€ä¸ªäº†ã€‚å› ä¸ºä»–ä»¬éƒ½é‡æ–°åˆ›å»ºäº†ã€‚è¿™ä¸€ç‚¹è¦ç‰¹åˆ«æ³¨æ„ï¼**

##### å¼‚æ­¥

åœ¨ç±»ç»„ä»¶ä¸­ `setState`æ˜¯å¼‚æ­¥çš„ï¼Œ**è¿™é‡Œ`useState`è¿”å›çš„å‡½æ•°ä¹Ÿæ˜¯å¼‚æ­¥çš„**ã€‚

è¿™å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•åœ¨å®å›¾æ›´æ–°å®Œæˆåå†è¿›è¡Œæ“ä½œï¼Ÿ

ç±»ç»„ä»¶å¯ä»¥ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ`componentDidUpdate`ã€å¯ä»¥ä½¿ç”¨`setState`çš„ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºæ›´æ–°åçš„å›è°ƒå‡½æ•°ã€‚é‚£å‡½æ•°å¼ç»„ä»¶é…åˆ`useState`å¦‚ä½•å®ç°å‘¢ï¼Ÿ

è¿™é‡Œå°±è¦è¯´åˆ°ç¬¬äºŒä¸ª hook `useEffect`

**æœ€åè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç–‘æƒ‘ç‚¹ï¼šæ˜æ˜ `setXXX`ä¼šå¯¼è‡´æ•´ä¸ªå‡½æ•°å¼ç»„ä»¶é‡æ–°æ‰§è¡Œï¼Œé‚£ä¸ºä»€ä¹ˆ state çš„çŠ¶æ€ä¸ä¼šé‡æ–°è¢«èµ‹æˆåˆå§‹å€¼å‘¢ï¼Ÿ**

##### useState å­˜å‚¨çŠ¶æ€ç®€è¦è¯´æ˜

çŠ¶æ€çŠ¶æ€ï¼Œ`useState`çš„ä½œç”¨å°±æ˜¯ç»™æ²¡æœ‰çŠ¶æ€çš„å‡½æ•°å¼ç»„ä»¶ä»¥çŠ¶æ€ï¼Œæ‰€ä»¥è®°ä½è¿™ä¸ªçŠ¶æ€çš„å˜æ›´æ˜¯å®ƒæœ¬èº«çš„èŒè´£ã€‚

æˆ‘ä»¬éœ€è¦ç†è§£æ˜¯å¦‚ä½•åšåˆ°çš„ï¼š

> åœ¨ react ä¸­é€šè¿‡ currentRenderingFiber æ¥æ ‡è¯†å½“å‰æ¸²æŸ“èŠ‚ç‚¹ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ fiber èŠ‚ç‚¹ï¼Œç”¨æ¥ä¿å­˜ç»„ä»¶çš„ç›¸å…³æ•°æ®ä¿¡æ¯ã€‚
> æ¯æ¬¡å‡½æ•°ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒcurrentRenderingFiber å°±è¢«èµ‹å€¼ä¸ºå½“å‰ç»„ä»¶å¯¹åº”çš„ fiberï¼Œæ‰€ä»¥å®é™…ä¸Š hook æ˜¯é€šè¿‡currentRenderingFiber æ¥è·å–çŠ¶æ€ä¿¡æ¯çš„ã€‚
>
> currentRenderingFiber.memorizedState ä¸­ä¿å­˜ä¸€æ¡hookå¯¹åº”æ•°æ®çš„å•å‘é“¾è¡¨ã€‚
>
> useStateçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›´æ–°æ•°æ®çš„æ–¹æ³•ï¼ˆdispatchActionï¼‰ï¼Œæ¯æ¬¡è°ƒç”¨æ­¤æ–¹æ³•æ—¶å°±ä¼šåˆ›å»ºä¸€ä¸ªupdate,å½“æˆ‘ä»¬å¤šæ¬¡æ›´æ–°æ—¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªç¯å¼é“¾è¡¨æ›´æ–°

*ps: currentRenderingFiber æŒ‚åœ¨ window å¯¹è±¡ä¸Šï¼Œä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆè¿™æ˜¯ react å†…å­˜å ç”¨å¤šçš„åŸå› ï¼Ÿï¼‰*

#### useEffectï¼ˆwatchï¼‰ã€useLayoutEffect å¤„ç†å‰¯ä½œç”¨

å‰¯ä½œç”¨å¤§å®¶éƒ½çŸ¥é“æŒ‡ä»€ä¹ˆï¼ˆæœªé¢„æœŸçš„è¦å‘ç”Ÿçš„æƒ…å†µï¼‰ï¼Œä¸‹é¢æ˜¯å‡ ç§å…¸å‹çš„å‰¯ä½œç”¨æƒ…å†µ

- ä¸Šé¢æˆ‘æ”¹å˜`useState`å®šä¹‰çš„çŠ¶æ€åå»æ“ä½œ domï¼Œå‘ç° dom è¿˜æ²¡å˜ã€‚è¿™å°±å±äºå¼‚æ­¥æ›´æ–°å¸¦æ¥çš„å‰¯ä½œç”¨ï¼Œæˆ‘ä»¬æœŸæœ›æ›´æ”¹çŠ¶æ€çš„æ“ä½œæ‰§è¡ŒåçŠ¶æ€å°±å‘ç”Ÿäº†æ”¹å˜ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å‰¯ä½œç”¨ï¼
- å®šæ—¶å™¨ä½¿ç”¨åéœ€è¦æ‰‹åŠ¨æ¸…é™¤æ‰è¡Œï¼Œè¿™æ ·ç®—æ˜¯é¢„æœŸä¹‹å¤–çš„äº‹æƒ…ä¹Ÿå°±æ˜¯å‰¯ä½œç”¨ï¼
- æˆ‘ä»¬åœ¨**å‡½æ•°å¼ç»„ä»¶ä¸­å†™äº†ä¸ªè¯·æ±‚æ–¹æ³•ï¼Œæ¯æ¬¡`setXXX` å¯¼è‡´å‡½æ•°å¼ç»„ä»¶é‡æ–°æ‰§è¡Œéƒ½ä¼šé‡æ–°è¯·æ±‚ï¼Œé‡æ–°è¯·æ±‚åˆå¯¼è‡´äº†`setXXX`çš„é‡å¤è°ƒç”¨ï¼Œå½¢æˆäº†æ­»å¾ªç¯**ã€‚ä¹Ÿå±äºå‰¯ä½œç”¨ï¼

react æä¾›äº† `useEffect`ã€`useLayoutEffect` æ¥å¤„ç†å‰¯ä½œç”¨ï¼

##### useEffect

æ¥æ”¶ä¸¤ä¸ªå‚æ•°

1. å›è°ƒå‡½æ•°ï¼Œ**å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨ç»„ä»¶é”€æ¯æ—¶æ‰§è¡Œ**
2. ä¾èµ–çš„å¯¹è±¡æ•°ç»„

```react
useEffect(() => {
  console.log('useEffect')
}, [])
```

å½“ä¾èµ–çš„å¯¹è±¡**æ”¹å˜æ—¶**å°±ä¼šè§¦å‘å›è°ƒå‡½æ•°ï¼Œ**å¦‚æœæ²¡æœ‰ä»»ä½•ä¾èµ–å°±åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ä¹Ÿè¦æ³¨æ„ `useEffect` çš„å›è°ƒæ˜¯å¼‚æ­¥çš„ï¼Œæœ‰ç‚¹åƒ vue çš„ `$nextTick`**  

ä¸‹é¢ä¸¾ä¸ªğŸŒ°ï¼š

æ¯æ¬¡ `text` æ”¹å˜æ—¶å°†é¦–å­—æ¯ç½®ä¸ºå¤§å†™

```react
const [text, setText] = useState('name')

useEffect(() => {
  setText(text.charAt(0).toUpperCase() + text.slice(1)) // è¿™é‡Œè°ƒç”¨ setText åˆä¼šä½¿æ•´ä¸ªå‡½æ•°å¼ç»„ä»¶é‡æ–°æ‰§è¡Œï¼Œå¯¼è‡´ç¬¬äºŒéè¿›è¿™é‡Œï¼ˆæ³¨æ„ä¸æ˜¯å› ä¸ºæ£€æµ‹åˆ° text å˜æ›´å†è¿›çš„ï¼Œæœ‰ä¸ªé¡ºåºå…ˆåé—®é¢˜ã€‚setText ä¹‹åå‡½æ•°å¼ç»„ä»¶ä¼šå…ˆæ•´ä¸ªé‡æ–°æ‰§è¡Œï¼‰
}, [text])

return (
  <div>
    <h1>app-{text}</h1>
    <button onClick={() => { // æ¯æ¬¡ text æ”¹å˜ï¼ŒuseEffect éƒ½ä¼šè§¦å‘
        setText('xiao')
      }}>click</button>
  </div>
)
```

è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¯¹ä¾èµ–çš„ç›‘å¬æ˜¯â€œæ·±â€è¿˜æ˜¯â€œæµ…â€â€”â€”ç­”æ¡ˆæ˜¯**æµ…**

**å³ `useEffect` åœ¨ä¾èµ–æ˜¯å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä¼šä¸åœçš„é‡å¤è§¦å‘**ã€‚ä½†æ˜¯å°±åƒ vue watch æ”¯æŒé”®è·¯å¾„ä¸€æ ·ï¼Œ`useEffect`çš„ä¾èµ–ä¹Ÿæ”¯æŒé”®è·¯å¾„ï¼

```react
useEffect(() => {
  setObjS({ name: 'mike'})
}, [objS.name]) // æ”¯æŒé”®è·¯å¾„
```

æœ‰äººå°±ä¼šé—®äº†ï¼Œè¿™é‡Œ `useEffect` çš„ä¾èµ–æ˜¯`objsS.name` ï¼Œé‚£å¦‚æœæˆ‘æ”¹å˜`objS.age`ï¼Œ`useEffect` ä¼šè§¦å‘å—ï¼Ÿ

ç­”æ¡ˆæ˜¯ä¼šçš„ã€‚

```react
const [objS, setObjS] = useState(obj)

useEffect(() => {
  setObjS({ age: 20 })
}, [objS.name])
```

çœ‹æ”¹å˜çŠ¶æ€çš„æ–¹å¼å’Œ`setState`ç±»ä¼¼ï¼Œéƒ½æ˜¯æ¥æ”¶ä¸€ä¸ªå‚æ•°ã€‚ä½†æ˜¯å’Œ `setState` ä¸åŒçš„æ˜¯:

- `setState` ä¼šå¯¹å¯¹è±¡ä½¿ç”¨`Object.assign`è¿›è¡Œåˆå¹¶
- **`useState` åˆ™æ˜¯ç›´æ¥è¦†ç›–**ï¼Œä¸Šé¢ç›¸å½“äºåªæœ‰ä¸€ä¸ª`age`å±æ€§äº†

æ‰€ä»¥å½“æˆ‘åªæ”¹å˜`objS.age`æ—¶ï¼Œ`objS.name`ä¹Ÿä¸€å®šå˜äº†ï¼ˆè¢«åˆ äº†ä¹Ÿæ˜¯å˜ï¼‰

*psï¼šè¿™é‡Œ react ä½¿ç”¨`Object.is`æ¥åˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰ï¼* 

å¼€å¤´è¯´äº†`useEffect`çš„ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å¯ä»¥å†è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œ**å¯ä»¥å–ä»£`componentWillUnMount`åœ¨é”€æ¯æ—¶æ‰§è¡Œä¸€äº›å¤„ç†å‰¯ä½œç”¨çš„æ“ä½œï¼**

```react
useEffect(() => {
  const timer = setInterval(() => {
    console.log(1111)
  }, 500)
  return () => {
    console.log('é”€æ¯')
    clearInterval(timer)
  }
}, [])
```

ä½†æ˜¯è¦æ³¨æ„ï¼Œ**å¦‚æœæœ‰ä¾èµ–çš„ state**ï¼Œåœ¨ state å‘ç”Ÿå˜æ›´æ—¶ï¼Œä¹Ÿä¼šè§¦å‘è¿™ä¸ªè¿”å›çš„å‡½æ•°ã€‚å› ä¸º`setXXX` å¸¦æ¥çš„å‡½æ•°å¼ç»„ä»¶é‡æ–°æ‰§è¡Œï¼ˆ~~è‡ªç„¶ä¹ŸåŒ…å«é”€æ¯çš„è¿‡ç¨‹~~ï¼‰ï¼Œä¼šå¯¼è‡´ `useEffect` ä¹Ÿé‡æ–°æ‰§è¡Œï¼Œä¸Šé¢çš„å®šæ—¶å™¨è™½ç„¶è¢«é”€æ¯äº†ï¼Œä½†æ˜¯éšååˆé‡æ–°åˆ›å»ºäº†ä¸ªæ–°çš„ï¼Œæ²¡æœ‰è¾¾æˆçœŸæ­£çš„é”€æ¯ç›®çš„ï¼

æ‰€ä»¥å¦‚æœåªæ˜¯ä¸ºäº†å¤„ç†ç»„ä»¶é”€æ¯æ—¶çš„çŠ¶æ€ï¼Œå¯ä»¥å•ç‹¬å†™ä¸€ä¸ª`useEffect`å¹¶ä¸”ä¸ä¾èµ–ä»»ä½• `state`ï¼ï¼ï¼

*ps: è¿™é‡Œæœ‰ä¸€ç‚¹å¥‡æ€ªï¼Œ`setXXX` ç†è®ºä¸Šä¼šè§¦å‘ç»„ä»¶é”€æ¯ï¼Œä½†æ˜¯å½“æˆ‘å†™å¤šä¸ª `useEffect` çš„æ—¶å€™é€šè¿‡`setXXX` å´æ²¡æœ‰è§¦å‘å…¶ä»–ï¼ˆæ²¡æœ‰ä¾èµ–è¿™ä¸ª`XXX`çŠ¶æ€ï¼‰çš„`useEffcet` çš„ return å‡½æ•°*	

ä¸Šé¢çš„é—®é¢˜ç»è¿‡å®éªŒå¾—å‡ºï¼š`setXXX` è™½ç„¶ä¼šå¯¼è‡´æ•´ä¸ªå‡½æ•°å¼ç»„ä»¶é‡æ–°æ‰§è¡Œï¼Œä½†æ²¡æœ‰ä¾èµ–`XXX`çŠ¶æ€çš„`useEffect` åªä¼šåœ¨ç¬¬ä¸€æ¬¡æ—¶æ‰§è¡Œã€‚å³**`setXXX`åªä¼šå½±å“å¯¹`XXX`çŠ¶æ€æœ‰ä¾èµ–çš„`useEffect`å£°æ˜ï¼Œå¯¹é‚£äº›æ— ä¾èµ–çš„ `useEffect` ä¸ä¼šäº§ç”Ÿå½±å“ï¼ˆåŒ…æ‹¬é”€æ¯ä¹Ÿä¸ä¼šæ‰§è¡Œï¼‰**

> react ä¼šä½¿ç”¨ depends åšæ¯”è¾ƒï¼Œç»™æœ‰å˜æ›´çš„æ‰“ä¸Š hasEffect çš„æ ‡è®°ï¼Œè¿™æ ·è¡¨æ˜è¿™ä¸ª useEffect è¢«å½±å“äº†åº”è¯¥é‡æ–°æ‰§è¡Œã€‚å¦åˆ™ä¸ä¼šåšä»»ä½•æ“ä½œï¼

æ‰€ä»¥æˆ‘ä»¬è¦æŠ“ä½`useEffect`  çš„æœ¬è´¨ï¼š

- é¦–æ¬¡æ¸²æŸ“å’Œ**ä¾èµ–å˜æ›´æ—¶**æ‰§è¡Œï¼Œå¦‚æœä¾èµ–æ²¡æœ‰å˜æ›´ï¼Œé‚£å°±ä¸ä¼š**å†**æ‰§è¡Œï¼ï¼ï¼
- ä¸Šé¢æˆ‘ä»¬å†™çš„ `useEffect` éƒ½åŠ äº†ç¬¬äºŒä¸ªå‚æ•°ä¸€ä¸ªç©ºæ•°ç»„`[]`ï¼Œè¿™æ ·å°±ç›¸å½“äºæ²¡æœ‰ä»»ä½•ä¾èµ–ï¼åªåœ¨ç»„ä»¶**ç¬¬ä¸€æ¬¡åŠ è½½**å’Œé”€æ¯æ—¶ä¼šæ‰§è¡Œç›¸å…³æ–¹æ³•
- **å¦‚æœæˆ‘ä»¬å¿½ç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œé‚£ä¹ˆ `useEffect` ä¼šåœ¨æ¯è½®ç»„ä»¶æ¸²æŸ“å®Œæˆåéƒ½æ‰§è¡Œï¼ï¼ï¼**ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯è¯´`setXXX`å¸¦æ¥çš„å‡½æ•°å¼ç»„ä»¶æ•´ä½“é‡æ–°æ‰§è¡Œä¸ä¼šæ‰§è¡Œæœ‰`[]`ä¾èµ–çš„`useEffect`ä½†æ˜¯ä¼šæ‰§è¡Œæ²¡æœ‰ç¬¬äºŒä¸ªä¾èµ–å‚æ•°çš„`useEffect`ï¼ï¼ˆå½“ç„¶ä¾èµ–`XXX`çš„è‚¯å®šä¹Ÿä¼šæ‰§è¡Œï¼‰

**æ€»ç»“ä¸€ä¸‹**ï¼š

1. `useEffect`åœ¨æ²¡æœ‰ä¾èµ–çš„æ—¶å€™ï¼ˆ`[]`ï¼‰åªä¼šæ‰§è¡Œä¸€æ¬¡

2. `useEffect`å›è°ƒä¹Ÿæ˜¯å¼‚æ­¥ï¼ŒReact ä¼šç­‰å¾…æµè§ˆå™¨å®Œæˆç”»é¢æ¸²æŸ“ä¹‹åæ‰ä¼šå»¶è¿Ÿè°ƒç”¨ `useEffect` 

3. `useEffect`ä¾èµ–æ¯”è¾ƒæ‰§è¡Œçš„æ˜¯æµ…æ¯”è¾ƒ

4. `useEffect`å¯ä»¥å¤šæ¬¡å£°æ˜ï¼Œå›è°ƒå‡½æ•°éƒ½ä¼šæ‰§è¡Œ

5. `useEffect` å›è°ƒå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°é”€æ¯æ—¶æ‰§è¡Œã€‚ä½†è¦æ³¨æ„1ã€`useEffect`çš„æœ¬è´¨ï¼›2ã€å¦‚æœæœ‰ä¾èµ–ä¼šåœ¨ä¾èµ–å˜æ›´æ—¶ä¹Ÿæ‰§è¡Œï¼

6. `useEffect` ç¬¬äºŒä¸ªå‚æ•°ä¼ `[]`å’Œä¸ä¼ çš„æ•ˆæœæ—¶å®Œå…¨ä¸åŒçš„ï¼ï¼

7. **`useEffect`å¯ä»¥æ›¿ä»£ç±»ç»„ä»¶ä¸­çš„`componentDidUpdate`ï¼Œå®ç°çœŸæ­£çš„ç±»ä¼¼äº vue watch çš„æ–¹æ³•**ã€‚åœ¨ç±»ç»„ä»¶ä¸­è¦åˆå§‹åŒ–æ—¶è·å–æ•°æ®åˆè¦åœ¨æ›´æ–°æ—¶è·å–æ•°æ®ï¼Œå°±éœ€è¦ä½¿ç”¨å¤šä¸ªç”Ÿå‘½å‘¨æœŸã€‚æœ‰äº†è¿™ä¸ªé’©å­ä¹‹åå¥¹ä¸€ä¸ªäººå°±å¯ä»¥å¹²è¿™ä¸ªäº‹æƒ…

   ```react
   useEffect(() => {
     type === 'coming' && getComingSoonFilms() // type å˜æ›´æ—¶å‘é€ä¸åŒçš„è¯·æ±‚ï¼Œå†é…åˆ useState å®Œæˆé‡æ¸²æŸ“
     type === 'release' && getReleaseFilms()
   }, [props.type]) // ä¾èµ– props çš„ type
   ```
8. **è°ƒç”¨ `setXXX` ä¼šè®©æ•´ä¸ªå‡½æ•°å¼ç»„ä»¶é‡æ–°æ‰§è¡Œï¼Œè¿™ä¹Ÿä¼šè®©åœ¨å…¶ä¸­å£°æ˜çš„ä¸€äº›å®šæ—¶å™¨æ–¹æ³•æ— é™è§¦å‘ã€‚å¦‚æœ `useEffect`åˆæ°å¥½ä¾èµ–äº†å®šæ—¶å™¨ä¸­çš„çŠ¶æ€æ¥æ”¹å˜æŸä¸ªçŠ¶æ€ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯** 

##### useLayoutEffect

ä¸‹é¢æ¥è®²ä¸€è®²å¦ä¸€ä¸ªå‰¯ä½œç”¨å¤„ç† hookã€‚**ä»–å’Œ `useEffect` æœ€å¤§çš„åŒºåˆ«æ˜¯è°ƒç”¨æ—¶æœºä¸åŒ**

- `useEffect` ä¼šåœ¨é¡µé¢æ¸²æŸ“å®Œåï¼ˆCSSOM + DOM ç»“åˆæˆæ¸²æŸ“æ ‘ï¼‰æ‰ä¼šæ‰§è¡Œï¼Œè¿™æ—¶å€™ç”¨æˆ·å·²ç»èƒ½çœ‹åˆ°é¡µé¢äº†ï¼Œä¸ä¼šé˜»å¡é¡µé¢çš„æ¸²æŸ“
- `useLayoutEffect`åˆ™æ‰§è¡Œçš„æ›´æ—©ï¼Œä¼šåœ¨ DOM æ›´æ–°å®Œæˆåç«‹åˆ»å°±åŒæ­¥æ‰§è¡Œï¼Œé˜»å¡é¡µé¢æ¸²æŸ“

ä½†æ˜¯`useLayoutEffect`ä¹Ÿæœ‰è‡ªå·±çš„ä½œç”¨â€”â€”é¿å…å¸ƒå±€æŠ–åŠ¨ï¼Œå³å¯¹ç”¨æˆ·å¯è§çš„ DOM ä¸ä¼šå› ä¸ºæˆ‘ä»¬çš„ DOM æ“ä½œçªç„¶é—ªä¸€ä¸‹ï¼Œç»™ç”¨æˆ·ä½“éªŒé€ æˆå½±å“ã€‚å› ä¸º`useLayoutEffect`ä¸­æ‰§è¡Œ DOM æ“ä½œæ˜¯åŒæ­¥çš„ï¼Œå¹¶ä¸” react ä¼šå¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œåˆå¹¶æ›´æ”¹ï¼

æ‰€ä»¥**å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½è¿˜æ˜¯ä½¿ç”¨`useEffect`**ï¼Œåªæœ‰åœ¨ä¿®æ”¹ DOM ä¸”ä»»åŠ¡è€—æ—¶ä¸é•¿çš„æ—¶å€™æ‰ä½¿ç”¨è¿™ä¸ª hookï¼Œçœ‹ä»–çš„åå­—ä¹Ÿèƒ½çœ‹å‡ºæ¥ã€‚ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†å¸ƒå±€ç›¸å…³çš„å‰¯ä½œç”¨çš„ï¼

#### useCallback è®°å¿†å‡½æ•°

ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨ `useState` ä¼šè®°ä½çŠ¶æ€ï¼Œåœ¨å‡½æ•°å¼ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ä¸ä¼šè¢«é‡æ–°åˆå§‹åŒ–ï¼ä½†æ˜¯ä¸Šé¢è®°ä½çš„æ˜¯çŠ¶æ€ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®°ä½å‡½æ•°å¼ç»„ä»¶ä¸­çš„å…¶ä»–å£°æ˜å‘¢ï¼Ÿ

æ¯”å¦‚å£°æ˜`const add = (a, b) =>  (a+b)` ï¼Œå½“å‡½æ•°å¼ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶è¿™ä¸ªå‡½æ•°è¡¨è¾¾å¼åˆä¼šè¢«é‡æ–°å£°æ˜ä¸€éï¼Œè¿™æ˜¾ç„¶æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚`useCallback`çš„ä½œç”¨å°±æ˜¯ç¼“å­˜è¿™äº›å£°æ˜ï¼Œåªæœ‰ä»–ä¾èµ–çš„çŠ¶æ€å˜åŒ–äº†æ‰å»é‡æ–°å£°æ˜è¿™ä¸ªå‡½æ•°ï¼

ä¸‹é¢æ˜¯ä¸ªğŸŒ°ï¼š

```react
import React, { useState, useCallback } from 'react'

export default function UseCallbackCom () {
  const [count, setcount] = useState(0)
  const callback = useCallback(
    () => {
      console.log('count ä¸ä¼šæ”¹å˜ï¼Œæ¯æ¬¡è§¦å‘æ—¶éƒ½æ˜¯åŸæ¥çš„å€¼', count)
    },
    []
  )
  console.log('æ¯æ¬¡æ¸²æŸ“éƒ½æ”¹å˜çš„ count', count)

  return (
    <div>
    {count}
    <button onClick={() => { setcount(count + 1)}}>count++</button>
    <button onClick={callback}>useCallback</button>
    </div>
  )
}
```

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨`useCallback`å£°æ˜çš„ `callback` æ–¹æ³•ï¼Œæ— è®ºåœ¨ count çš„å€¼æ˜¯å¤šå°‘çš„æ—¶å€™è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä»–çš„å€¼éƒ½æ˜¯åˆå§‹çš„ 0ã€‚**å› ä¸ºä»–æ˜¯â€œè®°å¿†å‡½æ•°â€ï¼Œä¸”æ²¡æœ‰ä»»ä½•ä¾èµ–ï¼Œæ•´ä¸ªå‡½æ•°çš„çŠ¶æ€ä¸€ç›´éƒ½æ˜¯å†å²çš„**

è¯¥æ–¹æ³•ä¸»è¦ç”¨æ¥ä¼˜åŒ–å‡½æ•°å¼ç»„ä»¶ï¼Œè®©ä¸€äº›ç‰¹åˆ«å¤§çš„æ–¹æ³•ä¸è¦é‡å¤å£°æ˜å½±å“æ€§èƒ½ï¼

é‚£ä»–æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿå®é™…ä¸Šå°±ä¸¤ä¸ªå­—â€”â€”**é—­åŒ…**

é€šè¿‡é—­åŒ…åœ¨è‡ªå·±çš„å‡½æ•°ä½œç”¨åŸŸä¸­ä¿å­˜äº†è‡ªå·±çš„å¤–éƒ¨å˜é‡ï¼Œåªè¦ä¾èµ–ä¸æ”¹å˜å°±ä¸ä¼šå»é‡æ–°æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå˜é‡å°±ä¼šä¸€ç›´æ˜¯è‡ªå·±é—­åŒ…ä¸­çš„å€¼ï¼

*ps: å’Œ useEffect ä¸€æ ·ï¼Œå¦‚æœæ²¡æœ‰ä¼ ç¬¬äºŒä¸ªå‚æ•°ï¼Œé‚£ä¹ˆåœ¨ç»„ä»¶æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¼šé‡æ–°å£°æ˜ï¼*

#### useMemo è®°å¿†ç»„ä»¶ï¼ˆcomputedï¼‰

**`useMemo`å’Œ`useCallback`çš„åŒºåˆ«**ï¼š`useMemo`ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”å°† return å€¼è¿”å›å¹¶è®°å¿†ã€‚

æ‰€ä»¥åœ¨æˆ‘ä»¬éœ€è¦**äº‹å…ˆè¿›è¡Œä¸€äº›è®¡ç®—çš„æ—¶å€™ä½¿ç”¨`useMemo`**ï¼Œå¦åˆ™ä½¿ç”¨`useCallback`å³å¯ï¼

`useMemo` å…¶å®æ˜¯å¯¹ç»“æœæœ‰ä¸€ä¸ªç¼“å­˜åŠŸèƒ½ï¼Œç›¸å½“äº vue ä¸­çš„ `computed`è®¡ç®—å±æ€§ï¼

ä¸‹é¢æ˜¯ä¸ªğŸŒ°ï¼š

```react
import React, { useMemo, useState, useEffect } from 'react'

export default function UseMemoCom () {
  const [cinemas, setCinemas] = useState([])
  const [keyword, setkeyword] = useState('')

  useEffect(() => {
    console.log('useEffect')
    // ... è·å–ç”µå½±é™¢åˆ—è¡¨
    setCinemas(data?.cinemas || [])
    // ...
  }, [])

  const cinemasList = useMemo(
    () => {
      console.log('usememo')
      return cinemas
        .filter((e) => {
          return e.name.includes(keyword)
        })
        .map((item) => {
          return <li key={item.cinemaId}>{item.name}</li>
        })
    }
    ,
    [keyword, cinemas] // åœ¨ keyword å’Œ cinemas æ”¹å˜æ—¶æ‰§è¡Œä¸Šé¢çš„è¿‡æ»¤æ–¹æ³•ï¼Œå¹¶å°†ç»“æœè¿”å›
  )

  const search = (e) => {
    setkeyword(e.target.value)
  }

  return (
    <div>
      <input value={keyword} onChange={search} />
      <ul>{cinemasList}</ul>
    </div>
  )
}

```

*ps: useMemo æ¯” useEffect æ‰§è¡Œçš„æ›´æ—©ï¼*

ä¸Šé¢æœ‰äº†è®°å¿†å‡½æ•°ã€è®°å¿†ç»„ä»¶ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœç»„ä»¶ä¸­å‡½æ•°å¾ˆå¤šéš¾é“æˆ‘è¦ä¸€ä¸ªä¸ªå…¨éƒ¨ç”¨ `useCallback` åŒ…è£¹ä¸€éå—ï¼Ÿé‚£å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥ React æä¾›äº†`React.memo`æ¥åŒ…è£¹æ•´ä¸ªå‡½æ•°å¼ç»„ä»¶ï¼Œä»¥è¾¾åˆ°ä¼˜åŒ–çš„ç›®çš„ã€‚è¿™ä¸ªåé¢å†è¯¦ç»†è¯´æ˜ï¼

#### useRef

åœ¨ç±»ç»„ä»¶ä¸­å†™äº†å¾ˆå¤š`React.createRef`æ¥åˆ›å»º DOM å¯¹è±¡çš„å¼•ç”¨ï¼Œåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­**ä¾ç„¶**å¯ä»¥ç»§ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥ã€‚react hooks ä¹Ÿæä¾›äº†ä¸€ä¸ªé’©å­æ¥åˆ›å»ºè¿™ä¸ªå¯¹è±¡â€”â€”`useRef`

ä»–çš„ä½œç”¨å’Œ`React.createRef`çš„ä½œç”¨æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼ä½†æ˜¯ä¹Ÿå…·æœ‰ä¸¤ç‚¹ç‰¹æ€§ï¼š

1. `useRef` æ¥æ”¶ä¸€ä¸ªåˆå§‹å€¼ä½œä¸º`ref.current`çš„å€¼ã€‚å³`const ref = useRef(10)` â€”â€”> `ref.current === 10`
2. `useRef`çš„å€¼ä¼šè¢«ç¼“å­˜ï¼Œæ‰€ä»¥**åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ï¼Œé™¤äº†ä½¿ç”¨`useState`è¿˜å¯ä»¥ç”¨`useRef`æ¥ç¼“å­˜çŠ¶æ€**ï¼ˆè¿™ä¸ react hook çš„å®ç°æœºåˆ¶æœ‰å…³ï¼‰

ä¸‹é¢ä¸¾ä¸ªğŸŒ°ï¼š

```react
import React, { useState, useRef, useCallback } from 'react'

export default function RefTodoList () {
  const ref = useRef()
  const count = useRef(0)
  const [stateCount, setstateCount] = useState(0)
  
  // ...

  return (
    <div>
      { count.current } - {stateCount}
      <button onClick={() => {
        count.current += 1 // å€¼ä¼šç´¯åŠ ï¼Œä¸ä¼šå› ä¸ºç»„ä»¶é‡æ–°æ¸²æŸ“å°±å¯¼è‡´å€¼è¢«é‡ç½®
        setstateCount(count.current + 1) // ä½†æ˜¯è¦æ‰‹åŠ¨é€šè¿‡å…¶ä»–æ–¹å¼è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œç›´æ¥ä½¿ç”¨ useRef æ”¹å€¼ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶
      }}>count++</button>
      <br />
      <input
        ref={ref}
      />
      <button
        onClick={() => {
          setList([...list, ref.current.value])
          ref.current.value = ''
          ref.current.focus()
        }}
      >
        add
      </button>
      { /*...*/ }
    </div>
  )
}

```

**éœ€è¦æ³¨æ„çš„æ˜¯ `useRef`çš„å€¼æ”¹å˜ ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼ï¼ï¼**

#### useReducerã€useContext å‡å°‘ç»„ä»¶å±‚çº§

##### useContext

åœ¨ react ç±»ç»„ä»¶ä¸­ä½¿ç”¨ `React.createContext` åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡å¯¹è±¡ç”¨æ¥é€šä¿¡ã€‚



## è¡¥å……ç‚¹

#### æ‰‹å†™ useState

```js
import ReactDOM from 'react-dom'

let _state //å…¨å±€_stateç”¨æ¥å­˜å‚¨stateçš„å€¼ï¼Œé¿å…é‡æ–°æ¸²æŸ“çš„æ—¶å€™è¢«myUseStateé‡ç½®ä¸ºåˆå§‹å€¼
const myUseState = initialValue => {
  _state = _state === undefined ? initialValue : _state // æ²¡æœ‰åˆå€¼çš„æ—¶å€™èµ‹åˆå€¼
  const setState = (newValue) => {
    _state = newValue
    render() // è°ƒç”¨é‡æ–°æ¸²æŸ“
  }
  return [_state, setState]
}

const render = () => {
  ReactDOM.render(<App1 />, document.getElementById('root'))
}

function App1() {
  const [n, setN] = myUseState(0)
  return (
    <div className='App'>
    <p>{n}</p>
		<button onClick={() => setN(n + 1)}>+1</button>
		</div>
		)
}
```

