# 开发经验总结

> 扩展开发中，总会遇到各种奇怪的问题，这里对遇到的一些问题进行记录。首先会记录网络上别人的一些经验

[toc]

## 一、开发相关

#### QA

- 代码一直不生效？

  检查是否有错误信息。注意background 的不错不提示在页面的控制台，需要主动打开 background 的页面查看

- 内联代码不生效？

  扩展不支持`<button onClick="javascript:test(this)></button> "`这种内联方法（CSP 策略组织）

- CSS 注入会影响页面代码！！！在页面上显示`injected stylesheet`就是扩展注入的 CSS

#### sourcemap

chrome > 99 版本时支持使用 sourcemap 来调试扩展，在此之前只支持内联的 sourcemap

## 二、支持 webpack 热更新

chrome extension 热更新实现方式如下。

1. 配置 webpack server，将 bundle 写到磁盘。
2. 通过 webpack plugin 暴露 compiler 对象。
3. 为 webpack server 增加中间件，拦截 reload 请求，转化为 SSE，compiler 注册编译完成的钩子，在回调函数中通过 SSE 发送消息。
4. chrome extension 启动后，background 与 webpack server 建立连接，监听 reload 方法，收到 server 的通知后，执行 chrome 本身的 reload 方法，完成更新。

SSE: https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events/Using_server-sent_events

## 三、其他

#### 查看已安装的扩展路径

可以查看别人的插件以寻找开发的一些思路

windows: `C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default\Extensions` 

mac：`/Users/用户名/Library/Application Support/Google/Chrome/Default/Extensions` 